<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo - ZUARSE</title>
    <link rel="stylesheet" href="admin-style.css">
</head>
<body>
    <script>
        // Verificar sesi√≥n de admin antes de cargar
        const sesion = JSON.parse(localStorage.getItem('sesion_zuarse'));
        if (!sesion || sesion.tipo !== 'admin') {
            window.location.href = 'login.html';
        }
    </script>
    <div class="admin-container">
        <header class="admin-header">
            <div class="header-content">
                <h1>Panel Administrativo</h1>
                <div class="header-actions">
                    <a href="index.html" class="btn-volver">Volver a Tienda</a>
                    <button onclick="cerrarSesionAdmin()" class="btn-logout">Cerrar Sesi√≥n</button>
                </div>
            </div>
        </header>

        <div class="admin-content">
            <!-- NAVEGACI√ìN DE PESTA√ëAS -->
            <nav class="tabs-nav">
                <button class="tab-btn active" data-tab="productos">Productos</button>
                <button class="tab-btn" data-tab="categorias">Categor√≠as</button>
                <button class="tab-btn" data-tab="clientes">Clientes</button>
                <button class="tab-btn" data-tab="proveedores">Proveedores</button>
                <button class="tab-btn" data-tab="compras">Compras</button>
                <button class="tab-btn" data-tab="pedidos">Pedidos</button>
                <button class="tab-btn" data-tab="notificaciones">Notificaciones</button>
                <button class="tab-btn" data-tab="reportes">Reportes</button>
            </nav>

            <!-- TAB: PRODUCTOS -->
            <section id="productos" class="tab-content active">
                <div class="tab-header">
                    <h2>Gestionar Productos</h2>
                    <button class="btn-agregar" id="btn-nuevo-producto">+ Nuevo Producto</button>
                </div>

                <div class="form-container" id="form-producto" style="display: none;">
                    <h3>Formulario de Producto</h3>
                    <form id="formulario-producto">
                        <div class="form-group">
                            <label for="prod-nombre">Nombre del Producto:</label>
                            <input type="text" id="prod-nombre" required>
                        </div>

                        <div class="form-group">
                            <label for="prod-descripcion">Descripci√≥n:</label>
                            <textarea id="prod-descripcion" rows="3"></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="prod-precio">Precio:</label>
                                <input type="number" id="prod-precio" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="prod-imagen">URL de Imagen:</label>
                                <input type="text" id="prod-imagen" placeholder="ej: images/producto.png">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="prod-stock">Stock:</label>
                                <input type="number" id="prod-stock" value="10">
                            </div>
                            <div class="form-group">
                                <label for="prod-categoria">Categor√≠a:</label>
                                <select id="prod-categoria">
                                    <option value="">-- Selecciona categor√≠a --</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-guardar">Guardar Producto</button>
                            <button type="button" class="btn-cancelar" id="cancelar-producto">Cancelar</button>
                        </div>
                    </form>
                </div>

                <div class="filtros-container" style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <input type="text" id="filtro-producto-nombre" placeholder="Buscar por nombre..." class="filtro-input" style="flex: 1;">
                    <input type="text" id="filtro-producto-categoria" placeholder="Buscar por categor√≠a..." class="filtro-input" style="flex: 1;">
                </div>

                <div class="lista-container">
                    <table id="tabla-productos">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Precio</th>
                                <th>Stock</th>
                                <th>Categor√≠a</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-productos">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                    <div id="sin-productos" class="empty-state">
                        No hay productos a√∫n. ¬°Crea uno nuevo!
                    </div>
                </div>
            </section>

            <!-- TAB: CATEGOR√çAS -->
            <section id="categorias" class="tab-content">
                <div class="tab-header">
                    <h2>Gestionar Categor√≠as</h2>
                    <button class="btn-agregar" id="btn-nueva-categoria">+ Nueva Categor√≠a</button>
                </div>

                <div class="form-container" id="form-categoria" style="display: none;">
                    <h3>Formulario de Categor√≠a</h3>
                    <form id="formulario-categoria">
                        <div class="form-group">
                            <label for="cat-nombre">Nombre de la Categor√≠a:</label>
                            <input type="text" id="cat-nombre" required>
                        </div>

                        <div class="form-group">
                            <label for="cat-descripcion">Descripci√≥n (opcional):</label>
                            <textarea id="cat-descripcion" rows="2"></textarea>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-guardar">Guardar Categor√≠a</button>
                            <button type="button" class="btn-cancelar" id="cancelar-categoria">Cancelar</button>
                        </div>
                    </form>
                </div>

                <div class="filtros-container" style="margin-bottom: 15px;">
                    <input type="text" id="filtro-categoria-nombre" placeholder="Buscar categor√≠a..." class="filtro-input" style="width: 100%;">
                </div>

                <div class="lista-container">
                    <table id="tabla-categorias">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Descripci√≥n</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-categorias">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                    <div id="sin-categorias" class="empty-state">
                        No hay categor√≠as a√∫n. ¬°Crea una nueva!
                    </div>
                </div>
            </section>

            <!-- TAB: CLIENTES -->
            <section id="clientes" class="tab-content">
                <div class="tab-header">
                    <h2>Gestionar Clientes</h2>
                    <button class="btn-agregar" id="btn-nuevo-cliente">+ Nuevo Cliente</button>
                </div>

                <div class="form-container" id="form-cliente" style="display: none;">
                    <h3>Formulario de Cliente</h3>
                    <form id="formulario-cliente">
                        <div class="form-group">
                            <label for="cli-nombre">Nombre:</label>
                            <input type="text" id="cli-nombre" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="cli-email">Email:</label>
                                <input type="email" id="cli-email" required>
                            </div>
                            <div class="form-group">
                                <label for="cli-telefono">Tel√©fono:</label>
                                <input type="tel" id="cli-telefono">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="cli-direccion">Direcci√≥n:</label>
                            <textarea id="cli-direccion" rows="2"></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="cli-ciudad">Ciudad:</label>
                                <input type="text" id="cli-ciudad">
                            </div>
                            <div class="form-group">
                                <label for="cli-estado">Estado:</label>
                                <select id="cli-estado">
                                    <option value="activo">Activo</option>
                                    <option value="inactivo">Inactivo</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-guardar">Guardar Cliente</button>
                            <button type="button" class="btn-cancelar" id="cancelar-cliente">Cancelar</button>
                        </div>
                    </form>
                </div>

                <div class="filtros-container" style="margin-bottom: 15px;">
                    <input type="text" id="filtro-cliente" placeholder="Buscar cliente (nombre, email, ciudad)..." class="filtro-input" style="width: 100%;">
                </div>

                <div class="lista-container">
                    <table id="tabla-clientes">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Email</th>
                                <th>Tel√©fono</th>
                                <th>Ciudad</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-clientes">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                    <div id="sin-clientes" class="empty-state">
                        No hay clientes a√∫n. ¬°Agrega uno nuevo!
                    </div>
                </div>
            </section>

            <!-- TAB: PROVEEDORES -->
            <section id="proveedores" class="tab-content">
                <div class="tab-header">
                    <h2>Gestionar Proveedores</h2>
                    <button class="btn-agregar" id="btn-nuevo-proveedor">+ Nuevo Proveedor</button>
                </div>

                <div class="form-container" id="form-proveedor" style="display: none;">
                    <h3>Formulario de Proveedor</h3>
                    <form id="formulario-proveedor">
                        <div class="form-group">
                            <label for="prov-nombre">Nombre del Proveedor:</label>
                            <input type="text" id="prov-nombre" required>
                        </div>

                        <div class="form-group">
                            <label for="prov-direccion">Direcci√≥n:</label>
                            <textarea id="prov-direccion" rows="2"></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="prov-telefono">Tel√©fono:</label>
                                <input type="tel" id="prov-telefono" placeholder="ej: +1 234 567 8900">
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-guardar">Guardar Proveedor</button>
                            <button type="button" class="btn-cancelar" id="cancelar-proveedor">Cancelar</button>
                        </div>
                    </form>
                </div>

                <div class="filtros-container">
                    <input type="text" id="filtro-proveedor" placeholder="Buscar proveedor..." class="filtro-input">
                </div>

                <div class="lista-container">
                    <table id="tabla-proveedores">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Proveedor</th>
                                <th>Direcci√≥n</th>
                                <th>Tel√©fono</th>
                                <th>Fecha Registro</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-proveedores">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                    <div id="sin-proveedores" class="empty-state">
                        No hay proveedores a√∫n. ¬°Crea uno nuevo!
                    </div>
                </div>
            </section>

            <!-- TAB: COMPRAS -->
            <section id="compras" class="tab-content">
                <div class="tab-header">
                    <h2>Gestionar Compras</h2>
                    <button class="btn-agregar" id="btn-nueva-compra">+ Nueva Compra</button>
                </div>

                <div class="form-container" id="form-compra" style="display: none;">
                    <h3>Registrar Compra</h3>
                    <form id="formulario-compra">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="compra-proveedor">Proveedor:</label>
                                <select id="compra-proveedor" required>
                                    <option value="">-- Selecciona proveedor --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="compra-id-factura">ID Factura:</label>
                                <input type="text" id="compra-id-factura" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="compra-fecha">Fecha:</label>
                                <input type="date" id="compra-fecha" required>
                            </div>
                        </div>

                        <fieldset class="form-fieldset">
                            <legend>Detalle de Productos</legend>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="compra-categoria-select">Categor√≠a:</label>
                                    <select id="compra-categoria-select">
                                        <option value="">-- Todas --</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="compra-producto-select">Producto:</label>
                                    <select id="compra-producto-select">
                                        <option value="">-- Selecciona --</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="compra-item-cantidad">Cantidad:</label>
                                    <input type="number" id="compra-item-cantidad" min="1" value="1">
                                </div>
                                <div class="form-group">
                                    <label for="compra-item-precio">Precio Unitario ($):</label>
                                    <input type="number" id="compra-item-precio" step="0.01" min="0" placeholder="0.00">
                                </div>
                                <div class="form-group" style="align-self: flex-end;">
                                    <button type="button" id="btn-add-prod-compra" class="btn-agregar" style="width: 100%;">+ Agregar</button>
                                </div>
                            </div>
                        </fieldset>

                        <div class="form-group">
                            <label for="compra-productos">Listado de Productos (agregados):</label>
                            <textarea id="compra-productos" rows="4" placeholder="Los productos agregados aparecer√°n aqu√≠..." required readonly></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="compra-total">Total Compra ($):</label>
                                <input type="number" id="compra-total" step="0.01" min="0" required readonly>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-guardar">Guardar Compra</button>
                            <button type="button" class="btn-cancelar" id="cancelar-compra">Cancelar</button>
                        </div>
                    </form>
                </div>

                <div class="filtros-container">
                    <h3>Historial de Compras</h3>
                    <input type="text" id="filtro-compra-proveedor" placeholder="Buscar por proveedor..." class="filtro-input">
                </div>

                <div class="lista-container">
                    <table id="tabla-compras">
                        <thead>
                            <tr>
                                <th>ID Factura</th>
                                <th>Proveedor</th>
                                <th>Fecha</th>
                                <th>Productos</th>
                                <th>Total</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-compras">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                    <div id="sin-compras" class="empty-state">
                        No hay compras registradas.
                    </div>
                </div>
            </section>

            <!-- TAB: PEDIDOS -->
            <section id="pedidos" class="tab-content">
                <div class="tab-header">
                    <h2>Gestionar Pedidos</h2>
                    <div class="filtros-pedidos">
                        <select id="filtro-estado" class="filtro">
                            <option value="">Todos los estados</option>
                            <option value="pendiente">Pendiente</option>
                            <option value="procesando">Procesando</option>
                            <option value="completado">Completado</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>
                </div>

                <div class="lista-container">
                    <table id="tabla-pedidos">
                        <thead>
                            <tr>
                                <th>ID Pedido</th>
                                <th>Cliente</th>
                                <th>Fecha</th>
                                <th>Total</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-pedidos">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                    <div id="sin-pedidos" class="empty-state">
                        No hay pedidos a√∫n. Los pedidos aparecer√°n aqu√≠.
                    </div>
                </div>

                <!-- Modal de detalles del pedido -->
                <div id="modal-pedido" class="modal" style="display: none;">
                    <div class="modal-content">
                        <span class="close-modal">&times;</span>
                        <h3>Detalles del Pedido</h3>
                        <div id="detalles-pedido-content">
                            <!-- Se llena din√°micamente -->
                        </div>
                        <div class="modal-footer">
                            <select id="nuevo-estado" class="form-group">
                                <option value="">Cambiar estado a:</option>
                                <option value="pendiente">Pendiente</option>
                                <option value="procesando">Procesando</option>
                                <option value="completado">Completado</option>
                                <option value="cancelado">Cancelado</option>
                            </select>
                            <button id="btn-guardar-estado" class="btn-guardar">Actualizar Estado</button>
                            <button id="btn-cerrar-modal" class="btn-cancelar">Cerrar</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TAB: NOTIFICACIONES -->
            <section id="notificaciones" class="tab-content">
                <div class="tab-header">
                    <h2>Notificaciones de Pedidos</h2>
                    <div class="filtros-notificaciones">
                        <input type="text" id="filtro-cliente-notif" placeholder="Buscar por cliente..." class="filtro-input">
                    </div>
                </div>

                <div class="lista-container">
                    <table id="tabla-notificaciones">
                        <thead>
                            <tr>
                                <th>Cliente</th>
                                <th>Fecha</th>
                                <th>ID Pedido</th>
                                <th>Productos</th>
                                <th>Cantidad de Art√≠culos</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-notificaciones">
                            <!-- Se llena din√°micamente -->
                        </tbody>
                    </table>
                    <div id="sin-notificaciones" class="empty-state">
                        No hay notificaciones de pedidos. Los pedidos aparecer√°n aqu√≠.
                    </div>
                </div>
            </section>

            <!-- TAB: REPORTES -->
            <section id="reportes" class="tab-content">
                <div class="tab-header">
                    <h2>Reportes</h2>
                    <h2>Reportes y An√°lisis</h2>
                </div>

                <div class="reportes-grid">
                    <div class="reporte-card">
                        <h3>Total de Productos</h3>
                        <p class="numero" id="total-productos">0</p>
                <!-- FILTROS DE REPORTES -->
                <div class="filtros-reportes-container" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="margin-top: 0;">Filtros y Segmentaci√≥n</h4>
                    <div class="form-row" style="gap: 10px; align-items: flex-end;">
                        <div class="form-group" style="flex: 1;">
                            <label>Fecha Inicio:</label>
                            <input type="date" id="rep-fecha-inicio">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Fecha Fin:</label>
                            <input type="date" id="rep-fecha-fin">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Periodicidad:</label>
                            <select id="rep-periodicidad">
                                <option value="dia">Por D√≠a</option>
                                <option value="mes">Por Mes</option>
                                <option value="anio">Por A√±o</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Estado:</label>
                            <select id="rep-estado">
                                <option value="">Todos</option>
                                <option value="pendiente">Pendiente</option>
                                <option value="procesando">Procesando</option>
                                <option value="completado">Completado</option>
                                <option value="cancelado">Cancelado</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <button id="btn-generar-reporte" class="btn-guardar" style="width: 100%;">Generar Reporte</button>
                        </div>
                    </div>
                    <div class="reporte-card">
                        <h3>Total de Clientes</h3>
                        <p class="numero" id="total-clientes">0</p>
                </div>

                <!-- TARJETAS DE M√âTRICAS (KPIs) -->
                <div class="reportes-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div class="reporte-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center;">
                        <h3 style="font-size: 14px; color: #666;">Total Ventas ($)</h3>
                        <p class="numero" id="kpi-total-venta" style="font-size: 24px; font-weight: bold; color: #667eea; margin: 10px 0;">$0.00</p>
                    </div>
                    <div class="reporte-card">
                        <h3>Ingresos Totales</h3>
                        <p class="numero" id="ingresos-totales">$0.00</p>
                    <div class="reporte-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center;">
                        <h3 style="font-size: 14px; color: #666;">Cant. Ventas</h3>
                        <p class="numero" id="kpi-cantidad-ventas" style="font-size: 24px; font-weight: bold; color: #28a745; margin: 10px 0;">0</p>
                    </div>
                    <div class="reporte-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center;">
                        <h3 style="font-size: 14px; color: #666;">Unidades Vendidas</h3>
                        <p class="numero" id="kpi-unidades" style="font-size: 24px; font-weight: bold; color: #17a2b8; margin: 10px 0;">0</p>
                    </div>
                    <div class="reporte-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center;">
                        <h3 style="font-size: 14px; color: #666;">Promedio Venta</h3>
                        <p class="numero" id="kpi-promedio" style="font-size: 24px; font-weight: bold; color: #ffc107; margin: 10px 0;">$0.00</p>
                    </div>
                    <div class="reporte-card" style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center;">
                        <h3 style="font-size: 14px; color: #666;">Min / Max</h3>
                        <p class="numero" id="kpi-min-max" style="font-size: 18px; font-weight: bold; color: #6c757d; margin: 10px 0;">$0 / $0</p>
                    </div>
                </div>

                <div class="acciones-admin">
                    <button class="btn-riesgo" id="btn-limpiar-datos">Limpiar Base de Datos</button>
                    <button class="btn-info" id="btn-exportar-datos">Exportar Datos</button>
                <!-- GR√ÅFICOS -->
                <div class="graficos-container" style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
                    <div style="flex: 2; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); min-width: 300px;">
                        <h4>Tendencia de Ventas</h4>
                        <canvas id="chart-tendencia"></canvas>
                    </div>
                    <div style="flex: 1; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); min-width: 300px;">
                        <h4>Ventas por Estado</h4>
                        <canvas id="chart-estado"></canvas>
                    </div>
                </div>

                <!-- TABLA DETALLADA -->
                <div class="lista-container">
                    <h4>Detalle de Registros</h4>
                    <table id="tabla-reportes">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Pedido ID</th>
                                <th>Cliente</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-reportes">
                            <!-- Din√°mico -->
                        </tbody>
                    </table>
                </div>

                <!-- ACCIONES DE EXPORTACI√ìN -->
                <div class="acciones-admin" style="margin-top: 20px; border-top: 1px solid #ddd; padding-top: 20px;">
                    <h3>Exportar Reporte</h3>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn-info" id="btn-exportar-excel">üìä Exportar a Excel (CSV)</button>
                        <button class="btn-info" id="btn-exportar-pdf-reporte" style="background-color: #dc3545;">üìÑ Exportar a PDF</button>
                        <button class="btn-riesgo" id="btn-limpiar-datos" style="margin-left: auto;">‚ö†Ô∏è Limpiar Base de Datos</button>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Librer√≠as para PDF y Email -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="config.js"></script>
    
    <script src="admin.js"></script>
    <script>
        // ==================== BUSCADORES DE PRODUCTOS ====================
        // L√≥gica para filtrar la tabla de productos en tiempo real
        document.addEventListener('DOMContentLoaded', function() {
            // Referencias a los campos de b√∫squeda
            const inputNombre = document.getElementById('filtro-producto-nombre');
            const inputCategoria = document.getElementById('filtro-producto-categoria');

            function filtrarProductos() {
                // Convertir a min√∫sculas para b√∫squeda "case-insensitive" (indiferente a may√∫sculas)
                const textoNombre = inputNombre.value.toLowerCase();
                const textoCategoria = inputCategoria.value.toLowerCase();
                const filas = document.querySelectorAll('#tbody-productos tr');

                filas.forEach(fila => {
                    // Obtener datos de las columnas: √çndice 1 (Nombre) y √çndice 4 (Categor√≠a)
                    const nombre = fila.children[1] ? fila.children[1].textContent.toLowerCase() : '';
                    const categoria = fila.children[4] ? fila.children[4].textContent.toLowerCase() : '';

                    // Verificar si el texto buscado est√° incluido en el contenido de la celda
                    const coincideNombre = nombre.includes(textoNombre);
                    const coincideCategoria = categoria.includes(textoCategoria);

                    // Mostrar fila solo si coincide con AMBOS filtros (Nombre Y Categor√≠a)
                    fila.style.display = (coincideNombre && coincideCategoria) ? '' : 'none';
                });
            }

            if (inputNombre) inputNombre.addEventListener('input', filtrarProductos);
            if (inputCategoria) inputCategoria.addEventListener('input', filtrarProductos);

            // ==================== BUSCADOR DE CATEGOR√çAS ====================
            // L√≥gica para filtrar la tabla de categor√≠as en tiempo real
            const inputCatNombre = document.getElementById('filtro-categoria-nombre');

            function filtrarCategorias() {
                // Convertir a min√∫sculas para b√∫squeda "case-insensitive"
                const texto = inputCatNombre.value.toLowerCase();
                const filas = document.querySelectorAll('#tbody-categorias tr');

                filas.forEach(fila => {
                    // Obtener nombre de la categor√≠a (√çndice 1)
                    const nombre = fila.children[1] ? fila.children[1].textContent.toLowerCase() : '';
                    // Mostrar fila si coincide
                    fila.style.display = nombre.includes(texto) ? '' : 'none';
                });
            }

            if (inputCatNombre) inputCatNombre.addEventListener('input', filtrarCategorias);

            // ==================== BUSCADOR DE CLIENTES ====================
            // L√≥gica para filtrar la tabla de clientes en tiempo real
            // Incluye normalizaci√≥n de texto y b√∫squeda difusa (fuzzy search)
            const inputCliente = document.getElementById('filtro-cliente');

            // Funci√≥n para normalizar texto (quitar tildes y min√∫sculas)
            function normalizar(texto) {
                return texto.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
            }

            // Algoritmo de Levenshtein para coincidencias aproximadas (errores de escritura)
            function levenshtein(a, b) {
                if (a.length === 0) return b.length;
                if (b.length === 0) return a.length;
                const matrix = [];
                for (let i = 0; i <= b.length; i++) matrix[i] = [i];
                for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
                for (let i = 1; i <= b.length; i++) {
                    for (let j = 1; j <= a.length; j++) {
                        const cost = b.charAt(i - 1) === a.charAt(j - 1) ? 0 : 1;
                        matrix[i][j] = Math.min(matrix[i - 1][j] + 1, matrix[i][j - 1] + 1, matrix[i - 1][j - 1] + cost);
                    }
                }
                return matrix[b.length][a.length];
            }

            function filtrarClientes() {
                const texto = normalizar(inputCliente.value);
                const filas = document.querySelectorAll('#tbody-clientes tr');

                filas.forEach(fila => {
                    const nombre = fila.children[1] ? normalizar(fila.children[1].textContent) : '';
                    const email = fila.children[2] ? normalizar(fila.children[2].textContent) : '';
                    const ciudad = fila.children[4] ? normalizar(fila.children[4].textContent) : '';
                    
                    // 1. Coincidencia directa (ignorando tildes)
                    let coincide = nombre.includes(texto) || email.includes(texto) || ciudad.includes(texto);

                    // 2. Coincidencia aproximada (si est√° mal escrito)
                    // Se activa solo si el texto buscado tiene m√°s de 3 caracteres para evitar falsos positivos
                    if (!coincide && texto.length > 3) {
                        // Umbral din√°mico: permite 2 errores si la palabra es larga (>5 chars), sino solo 1
                        const umbral = texto.length > 5 ? 2 : 1; 
                        const palabras = nombre.split(/\s+/); // Buscar en cada palabra del nombre
                        for (let palabra of palabras) {
                            if (levenshtein(texto, palabra) <= umbral) {
                                coincide = true;
                                break;
                            }
                        }
                    }

                    fila.style.display = coincide ? '' : 'none';
                });
            }

            if (inputCliente) inputCliente.addEventListener('input', filtrarClientes);
        });
    </script>
</body>
</html>
